<app-navbar></app-navbar>
<div class="page-wrapper">
  <div class="main-content-area">
    <div class="search-page-container">
      
      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-container">
        <div class="spinner"></div>
        <p>Loading documents...</p>
      </div>

      <!-- Main Content -->
      <div *ngIf="!isLoading" class="main-content">
      <div class="search-bar-container">
      <input 
        type="text" 
        placeholder="Search by title, author, or keywords..." 
        class="search-input" 
        [(ngModel)]="searchQuery"
        (keyup.enter)="onSearch()"
      />
      <button class="search-button" (click)="onSearch()">Search</button>
    </div>

    <div class="results-layout">
      <aside class="filter-sidebar">
        <div class="filter-header">
          <h3 class="filter-title">Filter</h3>
          <button class="collapse-button" (click)="toggleFilters()">
            <span *ngIf="isCollapsed">Show Filters</span>
            <span *ngIf="!isCollapsed">Hide Filters</span>
          </button>
        </div>

        <div class="filter-options-wrapper" [ngClass]="{'collapsed': isCollapsed}">
          <div class="filter-group">
            <h4 class="filter-group-title">By Author</h4>
            <input 
              type="text" 
              placeholder="Author name..." 
              class="search-input" 
              [(ngModel)]="authorName"
              (keyup)="onAuthorChange()"
            />
          </div>

          <div class="filter-group">
            <h4 class="filter-group-title">By Year</h4>
            <select class="search-input" [(ngModel)]="selectedYear" (change)="onYearChange(selectedYear)">
              <option value="">All Years</option>
              <option *ngFor="let year of availableYears()" [value]="year">{{ year }}</option>
            </select>
          </div>

          <div class="filter-group">
            <h4 class="filter-group-title">By Tags</h4>
            
            <!-- Add custom tag textbox -->
            <div class="custom-tag-input">
              <input 
                type="text" 
                placeholder="Add custom tag..." 
                class="search-input" 
                [(ngModel)]="customTagInput"
                (keyup.enter)="addCustomTag()"
              />
              <button class="add-tag-button" (click)="addCustomTag()">+</button>
            </div>
            
            <!-- Predefined tags -->
            <h5 class="filter-subtitle">Tags</h5>
            <ul class="filter-list">
              <li *ngFor="let tag of predefinedTags()">
                <label class="filter-option">
                  <input 
                    type="checkbox" 
                    [checked]="selectedTags.includes(tag)"
                    (change)="onTagChange(tag, $event)"
                  >
                  {{ tag }}
                </label>
              </li>
            </ul>
            
            <!-- Custom tags -->
            <h5 class="filter-subtitle" *ngIf="customTags().length > 0">Your Tags</h5>
            <ul class="filter-list">
              <li *ngFor="let tag of customTags()">
                <label class="filter-option custom-tag">
                  <input 
                    type="checkbox" 
                    [checked]="selectedTags.includes(tag)"
                    (change)="onTagChange(tag, $event)"
                  >
                  {{ tag }}
                  <button class="remove-tag-btn" (click)="removeCustomTag(tag); $event.stopPropagation()">
                    Ã—
                  </button>
                </label>
              </li>
            </ul>
          </div>

          <button class="search-button" (click)="clearFilters()" style="margin-top: 20px; width: 100%;">
            Clear All Filters
          </button>
        </div>
      </aside>

      <div class="search-results">
        <h2 class="results-count">{{ totalItems }} records found.</h2>

        <div class="result-card" *ngFor="let thesis of displayedTheses" (click)="viewThesis(thesis)">
          <h3 class="thesis-title">{{ thesis.title }}</h3>
          <p class="thesis-meta">By: {{ thesis.author }} | Year: {{ thesis.year }}</p>
          <div class="tags-container">
            <span class="tag tag-year">{{ thesis.year }}</span>
            <span *ngFor="let keyword of thesis.keywords" class="tag tag-keywords">
              {{ keyword }}
            </span>
          </div>
        </div>

        <div class="paginator" *ngIf="totalPages > 1">
          <!-- Your existing paginator code -->
        </div>
      </div>
    </div>
      </div> <!-- End main-content -->
    </div>
  </div> <!-- End main-content-area -->
  
  <app-footer></app-footer>
</div>