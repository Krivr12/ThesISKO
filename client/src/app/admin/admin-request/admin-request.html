<div class="layout">
  <app-admin-side-bar></app-admin-side-bar>

  <div class="content">
    <div class="toolbar">
      <button type="button" mat-button class="return" (click)="goBack()">
        <mat-icon>arrow_back</mat-icon> Return
      </button>
    </div>

    <div class="rectangle">
      <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8 full-width-table no-table-margin">
        <ng-container matColumnDef="requestor">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Requestor</th>
          <td mat-cell *matCellDef="let row">{{ row.requestor_name }}</td>
        </ng-container>

        <ng-container matColumnDef="time">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Time</th>
          <td mat-cell *matCellDef="let row">{{ row.date }} {{ row.time }}</td>
        </ng-container>

        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Title</th>
          <td mat-cell *matCellDef="let row">{{ row.title }}</td>
        </ng-container>

        <ng-container matColumnDef="chapters">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Chapters</th>
          <td mat-cell *matCellDef="let row">{{ formatChapters(row.selected_chapter) }}</td>
        </ng-container>

        <ng-container matColumnDef="purpose">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Purpose</th>
          <td mat-cell *matCellDef="let row">{{ row.purpose }}</td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let row">
            <button mat-button class="link-btn" [disableRipple]="true" (click)="openVerifyDialog(row)">
              Open Request
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>

      <mat-paginator [pageSize]="10" [pageSizeOptions]="[5, 10, 20]"></mat-paginator>
    </div>
  </div>
</div>

<!-- Dialog Template -->
<ng-template #verifyDialog let-dialogRef="dialogRef" let-data>
  <div class="ag-header">
    <h4 class="ag-title">Open Request</h4>
    <button type="button" class="ag-close" (click)="dialogRef.close()" aria-label="Close">✕</button>
  </div>

  <mat-dialog-content class="ag-body">

    <div style="display:grid;grid-template-columns:160px 1fr;gap:8px 12px;align-items:start;" class="requestor">
      <div><b>Requestor</b></div> <div>{{ data.row.requestor_name || '—' }}</div>
      <div><b>Time</b></div>      <div>{{ (data.row.date || '—') }} {{ (data.row.time || '') }}</div>
      <div><b>Title</b></div>     <div>{{ data.row.title || '—' }}</div>
      <div><b>Chapters</b></div>  <div>{{ formatChapters(data.row.selected_chapter || '') || '—' }}</div>
      <div><b>Purpose</b></div>   <div>{{ data.row.purpose || '—' }}</div>
      <div><b>School</b></div>     <div>{{ data.row.school || '—' }}</div>
      <div><b>Department</b></div>     <div>{{ data.row.department || '—' }}</div>
      <div><b>Program</b></div>     <div>{{ data.row.program || '—' }}</div>
      <div><b>Country</b></div>     <div>{{ data.row.country || '—' }}</div>
      <div><b>City</b></div>     <div>{{ data.row.city || '—' }}</div>
      <div><b>Email</b></div>     <div>{{ data.row.email || '—' }}</div>
      
    </div>

    <div class="datarequested">
      
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <div class="actions">
    <button class="btn primary" (click)="approveRequest()">
        Approve Request
      </button>
      <button class="btn ghost" (click)="rejectRequest()">
        Reject Request
      </button>
    </div>
  </mat-dialog-actions>
</ng-template>
