<div class="container">
    <app-sidenavbar> </app-sidenavbar>  
        <mat-sidenav-container class="container" style="height: 100vh;">
          <mat-sidenav-content class="content">
            <div class="rectangle-container">
      
              <!-- Controls -->
              <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                <!-- Department Buttons -->
                <button mat-raised-button color="accent" (click)="viewAll()">
                  View All
                </button>                
                <button mat-raised-button color="primary" (click)="filterByDepartment('IT')">
                  View IT
                </button>
                <button mat-raised-button color="accent" (click)="filterByDepartment('CS')">
                  View CS
                </button>
      
                <!-- Section Dropdown -->
                <mat-form-field appearance="outline" style="min-width: 200px;">
                  <mat-label>Sort by Section</mat-label>
                  <mat-select [(value)]="selectedSection" (selectionChange)="filterBySection($event.value)">
                    <mat-option *ngFor="let section of sections" [value]="section">
                      {{ section }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>


                <span class="spacer"></span>  
                <button mat-raised-button color="accent" class="addButton" (click)="openAddDialog()">
                  Add Group
                </button>
                
                <ng-template #addGroupDialog let-dialogRef="dialogRef">
                  <div class="ag-header">
                    <h3 class="ag-title">Add Group</h3>
                    <button type="button" class="ag-close" (click)="dialogRef.close()" aria-label="Close">
                      âœ•
                    </button>
                  </div>
                
                  <mat-dialog-content class="ag-body">
                    <form #addForm="ngForm" class="ag-form" (keydown.enter)="$event.preventDefault()">
                      <!-- Leader -->
                      <div class="ag-section-title">Leader</div>
                
                      <div class="ag-grid-2">
                        <mat-form-field appearance="outline" class="ag-field">
                          <mat-label>Firstname</mat-label>
                          <input matInput [(ngModel)]="leader.firstName" name="leaderFirst" placeholder="Firstname*" required />
                        </mat-form-field>
                
                        <mat-form-field appearance="outline" class="ag-field">
                          <mat-label>Lastname</mat-label>
                          <input matInput [(ngModel)]="leader.lastName" name="leaderLast" placeholder="Lastname*" required />
                        </mat-form-field>
                      </div>
                
                      <mat-form-field appearance="outline" class="ag-field">
                        <mat-label>Email</mat-label>
                        <input matInput type="email" [(ngModel)]="leader.email" name="leaderEmail" placeholder="Email*" required />
                      </mat-form-field>
                
                      <hr class="ag-divider" />
                
                      <!-- Members -->
                      <div class="ag-section-title ag-members-head">
                        Members
                     
                      </div>
                
                      <div *ngIf="members.length === 0" class="ag-muted">
                        No members added. This will be saved as an individual thesis.
                      </div>
                
                      <div *ngFor="let m of members; let i = index" class="ag-member">
                        <div class="ag-grid-2">
                          <mat-form-field appearance="outline" class="ag-field">
                            <mat-label>Firstname</mat-label>
                            <input matInput [(ngModel)]="m.firstName" [name]="'memberFirst_'+i" placeholder="Firstname*" required />
                          </mat-form-field>
                
                          <mat-form-field appearance="outline" class="ag-field">
                            <mat-label>Lastname</mat-label>
                            <input matInput [(ngModel)]="m.lastName" [name]="'memberLast_'+i" placeholder="Lastname*" required />
                          </mat-form-field>
                        </div>
                
                        <mat-form-field appearance="outline" class="ag-field">
                          <mat-label>Email</mat-label>
                          <input matInput type="email" [(ngModel)]="m.email" [name]="'memberEmail_'+i" placeholder="Email*" required />
                        </mat-form-field>
                
                        <div class="ag-row-end">
                          <button type="button" mat-button color="warn" (click)="removeMemberRow(i)">Remove</button>
                        </div>
                
                        <hr class="ag-divider ag-divider--soft" *ngIf="i !== members.length - 1" />
                      </div>
                    </form>
                  </mat-dialog-content>
                
                  <mat-dialog-actions align="start" class="ag-actions">
                    <button class="ag-pill ag-pill--primary" [disabled]="!isFormValid()" (click)="saveNewGroup(dialogRef)">
                      Create Group
                    </button>
                
                    <button class="ag-pill ag-pill--outline" type="button" (click)="addMemberRow()">
                      Add Members
                    </button>
                
                    <span class="ag-flex-spacer"></span>
                
                  </mat-dialog-actions>
                </ng-template>
                
                
                
                
              </div>
      
            
            
            
              <!-- Table -->
              <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8 full-width-table">
      
                <!-- Group ID -->
                <ng-container matColumnDef="groupId">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Group ID</th>
                  <td mat-cell *matCellDef="let element">{{ element.group_id }}</td>
                </ng-container>
      
                <!-- Leader -->
                <ng-container matColumnDef="leader">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Leader</th>
                  <td mat-cell *matCellDef="let element">{{ element.leader }}</td>
                </ng-container>
      
                <!-- Status -->
                <ng-container matColumnDef="status">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
                  <td mat-cell *matCellDef="let element" class="status-cell">
                    <span
                      class="status-dot"
                      [ngClass]="{
                        'ongoing': element.status === 'Ongoing',
                        'rejected': element.status === 'Rejected',
                        'approved': element.status === 'Approved'
                      }">
                    </span>
                    <span class="status-text"
                      [ngClass]="{
                        'ongoing-text': element.status === 'Ongoing',
                        'rejected-text': element.status === 'Rejected',
                        'approved-text': element.status === 'Approved'
                      }">
                      {{ element.status }}
                    </span>
                  </td>
                </ng-container>
      
                <!-- Verify button -->
                <ng-container matColumnDef="forApproval">
                  <th mat-header-cell *matHeaderCellDef>Verify</th>
                  <td mat-cell *matCellDef="let element" class="for-approval-cell">
                    <button mat-raised-button color="primary"
                            (click)="goToApproval(element.group_id)">
                      VERIFY
                    </button>
                  </td>
                </ng-container>
      
                <!-- Header + Rows -->
                <tr mat-header-row *matHeaderRowDef="groupColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: groupColumns;"></tr>
              </table>
      
              <!-- Paginator -->
              <mat-paginator [pageSize]="5" [pageSizeOptions]="[5, 10, 20]"></mat-paginator>
            </div>
          </mat-sidenav-content>
        </mat-sidenav-container>
      </div>
      